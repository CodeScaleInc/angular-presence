!function(){"use strict";angular.module("presence",[]).directive("presence",["$presence","prTypes",function(a,b){function c(a){return a?a.split(" "):b.getAllTypeNames()}return{restrict:"A",link:function(d,e,f){angular.forEach(c(f.presence),function(c){var d=b.get(c);e.on(d.events,function(){a.registerAction(d.name)})})}}}]).factory("prTypes",function(){return{MOUSE:{name:"MOUSE",events:"click mousedown mouseup mousemove"},KEYBOARD:{name:"KEYBOARD",events:"keypress keydown keyup"},TOUCH:{name:"TOUCH",events:"touchstart touchmove touchend touchenter touchleave touchcancel"},getAllTypeNames:function(){return["MOUSE","KEYBOARD","TOUCH"]},get:function(a){if(a=a.toUpperCase(),this[a])return this[a];throw new Error("Unknown type for monitoring presence: "+a)}}}).factory("$presence",["$timeout","$q","orderByFilter","prTypes",function(a,b,c,d){function e(a){function e(){return angular.forEach(a,function(b,c){angular.isObject(b)||(a[c]=b={enter:b}),b.name=c,b.enter=b.enter||0}),a}function g(){var b=[];return angular.forEach(a,function(a){b.push(a)}),c(b,"enter")}function h(){angular.forEach(m,function(a,b){a.id=b,a.onEnter=function(a){return j(b,a)},a.onLeave=function(a){return k(b,a)}})}function n(){a.onChange=function(a){return i(a)},a.getCurrent=function(){return l()}}function o(){function a(a){return function(){f(a)}}function c(a){-1===h.indexOf(a)&&(p[a]=e+1)}for(var e=0;e<m.length;e++){var g=m[e];if(g.initial===!0&&(q=e),g.accept){var h=g.accept.toUpperCase();angular.forEach(d.getAllTypeNames(),c)}s[e]=b.defer(),r[e]=a(e)}}return a=e(),m=g(),h(),n(),o(),f(q),a}function f(b){var c=n;m[c]&&(m[c].leftOn=new Date,m[c].active=!1),m[b].active=!0,m[b].enteredOn=new Date,m[b].enteredFrom=m[c],a(function(){s[b].notify(m[b]),t.notify(m[b])}),g(b),n=b}function g(b){m[b+1]&&(a.cancel(o),o=a(r[b+1],m[b+1].enter-m[b].enter))}function h(a){if(m){var b=p[a]||0;n>b?f(b):b===n&&g(b)}}function i(a){return t.promise.then(null,null,a)}function j(a,b){return s[a].promise.then(null,null,b)}function k(a,b){return a<m.length?j(a+1,b):j(0,b)}function l(){return m[n]}var m,n,o,p={},q=0,r=[],s=[],t=b.defer();return{init:e,registerAction:h,onStateChange:i,getCurrentState:l}}])}();