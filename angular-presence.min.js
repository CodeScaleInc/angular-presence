!function(){"use strict";angular.module("presence",[]).directive("presence",["$presence","types",function(a,b){function c(a){return a?a.split(" "):b.getAllTypeNames()}return{restrict:"A",link:function(d,e,f){angular.forEach(c(f.presence),function(c){var d=b.get(c);e.on(d.events,function(){a.registerAction(d.name)})})}}}]).factory("types",function(){return{MOUSE:{name:"MOUSE",events:"click mousedown mouseup mousemove"},KEYBOARD:{name:"KEYBOARD",events:"keypress keydown keyup"},TOUCH:{name:"TOUCH",events:"touchstart touchmove touchend touchenter touchleave touchcancel"},getAllTypeNames:function(){return["MOUSE","KEYBOARD","TOUCH"]},get:function(a){if(a=a.toUpperCase(),this[a])return this[a];throw new Error("Unknown type for monitoring presence: "+a)}}}).factory("$presence",["$timeout","$q","orderByFilter","types",function(a,b,c,d){function e(a){function b(){return angular.forEach(a,function(b,c){angular.isObject(b)||(a[c]=b={enter:b}),b.name=c,b.enter=b.enter||0}),a}function e(){var b=[];return angular.forEach(a,function(a){b.push(a)}),c(b,"enter")}function g(){angular.forEach(o,function(a,b){a.id=b,a.onEnter=function(a){l(b,a)},a.onLeave=function(a){m(b,a)}})}function h(){a.onChange=function(a){k(a)},a.getCurrent=function(){return n()}}function i(){angular.forEach(o,function(a,b){function c(c){-1===a.accept.toUpperCase().indexOf(c)&&(r[c]=b+1)}a.initial===!0&&(s=b),a.accept&&angular.forEach(d.getAllTypeNames(),c)})}return a=b(),o=e(),g(),h(),i(),f(s),a}function f(b){var c=p;o[c]&&(o[c].leftOn=new Date,o[c].active=!1),o[b].active=!0,o[b].enteredOn=new Date,o[b].enteredFrom=o[c]?o[c].name:void 0,p=b,a(function(){h(t[c]),h(u[b]),h(v)}),i()}function g(){f(p+1)}function h(a){if(a)for(var b=0;b<a.length;b++)a[b](o[p])}function i(){var b=p+1;o[b]&&(a.cancel(q),q=a(g,o[b].enter-o[p].enter))}function j(a){if(o){var b=r[a]||0;p>b?f(b):b===p&&i()}}function k(a){v.push(a)}function l(a,b){(u[a]||(u[a]=[])).push(b)}function m(a,b){(t[a]||(t[a]=[])).push(b)}function n(){return o[p]}var o,p,q,r={},s=0,t={},u={},v=[];return{init:e,registerAction:j}}])}();